---
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const introOffers = [
  {
    nameKey: 'pkg.intro1.name' as const,
    descKey: 'pkg.intro1.desc' as const,
    price: 45,
    sessions: 1,
    validity: '1 month',
    validityFr: '1 mois',
  },
  {
    nameKey: 'pkg.intro5.name' as const,
    descKey: 'pkg.intro5.desc' as const,
    price: 260,
    sessions: 5,
    validity: '6 weeks',
    validityFr: '6 semaines',
  },
];

const regularPackages = [
  {
    nameKey: 'pkg.3pack.name' as const,
    descKey: 'pkg.3pack.desc' as const,
    price: 180,
    sessions: 3,
    validity: '3 months',
    validityFr: '3 mois',
  },
  {
    nameKey: 'pkg.10pack.name' as const,
    descKey: 'pkg.10pack.desc' as const,
    price: 550,
    sessions: 10,
    validity: '6 months',
    validityFr: '6 mois',
  },
];

const intensivePrograms = [
  {
    nameKey: 'pkg.intensive1.name' as const,
    descKey: 'pkg.intensive1.desc' as const,
    price: 300,
    sessions: 6,
    validity: '2 months',
    validityFr: '2 mois',
  },
  {
    nameKey: 'pkg.intensive2.name' as const,
    descKey: 'pkg.intensive2.desc' as const,
    price: 575,
    sessions: 12,
    validity: '2 months',
    validityFr: '2 mois',
  },
];

const categories = [
  { titleKey: 'classes.introOffers' as const, packages: introOffers },
  { titleKey: 'classes.regularPackages' as const, packages: regularPackages },
  { titleKey: 'classes.intensivePrograms' as const, packages: intensivePrograms },
];
---

<section id="classes" class="section-padding">
  <div class="max-w-3xl mx-auto">
    <!-- Section Header -->
    <div class="mb-16 scroll-animate">
      <span class="text-xs tracking-[0.2em] uppercase font-medium" style="color: var(--color-accent-rose);">{t('classes.label')}</span>
      <h2 class="mt-4 mb-4">{t('classes.heading')}</h2>
      <p style="color: var(--color-text-muted);">{t('classes.intro')}</p>
    </div>

    <!-- Grouped editorial list -->
    {categories.map((category) => (
      <div class="mb-14 scroll-animate">
        <h3 class="font-serif mb-6" style="color: var(--color-text);">
          {t(category.titleKey)}
        </h3>

        {category.packages.map((pkg) => (
          <div class="py-6" style="border-top: 1px solid var(--color-border-light);">
            <div class="flex items-baseline justify-between gap-4 mb-2">
              <span class="font-serif text-lg" style="color: var(--color-text);">{t(pkg.nameKey)}</span>
              <span class="font-serif text-lg whitespace-nowrap" style="color: var(--color-accent-rose);">
                {pkg.price}&euro;
              </span>
            </div>
            <p class="text-sm mb-1" style="color: var(--color-text-muted);">
              {pkg.sessions} {pkg.sessions === 1 ? t('classes.session') : t('classes.sessions')} &middot; {t('classes.validity')} {lang === 'fr' ? pkg.validityFr : pkg.validity}
              {pkg.sessions > 1 && (
                <span> &middot; {Math.round(pkg.price / pkg.sessions)}&euro;{t('classes.perSession')}</span>
              )}
            </p>
            <p class="text-sm leading-relaxed" style="color: var(--color-text-body);">
              {t(pkg.descKey)}
            </p>
          </div>
        ))}
      </div>
    ))}

    <!-- Student specials -->
    <div class="py-8 scroll-animate" style="border-top: 1px solid var(--color-border-light);">
      <h3 class="font-serif mb-3" style="color: var(--color-text);">{t('classes.studentTitle')}</h3>
      <p class="mb-6" style="color: var(--color-text-muted);">{t('classes.studentText')}</p>
      <a href="mailto:rorosey@icloud.com" class="btn-outline text-sm">
        {t('classes.studentCta')}
      </a>
    </div>

    <!-- Single CTA -->
    <div class="mt-12 scroll-animate">
      <a href={translatePath('/booking')} class="btn-primary">
        {t('classes.bookCta')}
      </a>
    </div>
  </div>
</section>
